#!/bin/bash
. "$(dirname "$0")/_/husky.sh"

npx lint-staged

# Protect main from accidental commits.
echo "===\n>> Pre-commit Hook:: Checking branch name..."

valid_branch_type_regex="feature\|feat\|fix\|bugfix\|chore\|release"
valid_branch_case_regex="[A-Z]"
branchName=$(git branch | grep '*' | sed 's/* //')

if [ "$branchName" = "main" ]
then
  echo "\nðŸš« Commits na branch main nÃ£o sÃ£o permitidos!\n" && exit 1
else
  echo "\nâœ… O commit nÃ£o Ã© na branch main.\n"
fi

if ! echo "$branchName" | grep -q -w -i "$valid_branch_type_regex"
then
  echo "\nðŸš« O nome da branch deve iniciar com feature, feat, fix, bugfix, chore ou release.\n"
  exit 1
else
  echo "\nâœ… Conseguimos identificar se Ã© feature, feat, fix, bugfix, chore ou release. \n"
fi

if echo "$branchName" | grep -q "$valid_branch_case_regex"
then
  echo "\nðŸš« O nome da branch deve conter apenas letras minÃºsculas.\n"
  exit 1
else
  echo "\nâœ… O nome da branch contÃ©m apenas letras minÃºsculas. \n"
fi


echo ">> Finish checking branch name.\n==="

exit 0
